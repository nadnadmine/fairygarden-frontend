<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=1440">
  <title>Our Products - Fairy Garden</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Metal&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="viewall.css">
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>

<body>
  <div id="header-container"></div>
  <div id="auth-container"></div>

  <section class="all-products">
    <h2 class="section-title">Our Products</h2>
    
    <div id="viewall-grid" class="products-grid">
        <p style="text-align:center; width:100%; padding: 20px;">Sedang mengambil bunga cantik untukmu...</p>
    </div>
  </section>

  <footer>
    <p><b>YOU CAN FIND US ON</b></p>
    <p><i class="fa-brands fa-instagram"></i> @fairygarden    <i class="fa-regular fa-envelope"></i> fairygarden@gmail.com</p>
  </footer>

  <script src="script.js"></script>
  
  <script>
    // 1. Load Header
    fetch("header.html")
      .then(res => res.text())
      .then(html => {
        document.getElementById("header-container").innerHTML = html;
        // TIDAK PERLU nambah event listener userButton disini lagi.
        // script.js sudah menanganinya secara global (Global Listener).
      });

    // 2. Load Modal Auth
    fetch("modal-auth.html")
      .then(res => res.text())
      .then(html => {
        document.getElementById("auth-container").innerHTML = html;
      });

    // 3. Logic Render Produk (Khusus Halaman Ini)
    document.addEventListener("DOMContentLoaded", async () => {
        const grid = document.getElementById("viewall-grid");
        if (!grid) return;

        try {
            // Ambil Data Terbaru dari Server
            const res = await fetch("https://fairygarden-backend.vercel.app/api/products");
            if(!res.ok) throw new Error("Gagal fetch");
            const products = await res.json();

            grid.innerHTML = ""; // Bersihkan loading

            if(products.length === 0) {
                grid.innerHTML = "<p style='text-align:center; width:100%;'>Belum ada produk.</p>";
                return;
            }

            // Render Kartu Produk
            products.forEach(p => {
                // Fix Gambar URL
                let img = p.image_url;
                if(img && !img.startsWith('http')) {
                    img = "https://fairygarden-backend.vercel.app/uploads/" + img;
                }

                // Gunakan ID Angka untuk link
                grid.innerHTML += `
                    <a href="product-detail.html?id=${p.product_id}" class="product-card">
                      <div class="product-box">
                        <img src="${img}" alt="${p.product_name}">
                      </div>
                      <b>${p.product_name}</b>
                      <div>Rp. ${parseInt(p.price).toLocaleString("id-ID")}</div>
                    </a>
                `;
            });

        } catch (err) {
            grid.innerHTML = "<p style='text-align:center; width:100%;'>Gagal memuat produk. Cek koneksi.</p>";
            console.error(err);
        }
    });
  </script>
</body>
</html>